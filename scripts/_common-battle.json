{
  "vars": [
    {
      "name": "setup",
      "value": "0",
      "type": "INT"
    }
  ],
  "includes": [
    "_common-no_op"
  ],
  "states": {
    "_common_battle-three_attack": {
      "name": "Common Battle - Three Attack",
      "statements": [
        {
          "condition": {
            "is": "SCREEN",
            "value": "game-battle",
            "and": [
              {
                "is": "SCREEN",
                "value": "game-battle-auto_off"
              },
              {
                "is": "SCREEN",
                "value": "battle-unit-0_ready"
              }
            ]
          },
          "actions": [
            {
              "type": "INFO",
              "value": "Three Attack"
            },
            {
              "type": "SET",
              "var": "_loops",
              "value": "0"
            },
            {
              "type": "BATCH",
              "value": "START"
            },
            {
              "type": "CALL",
              "value": "@tapUnit",
              "args": {"index":"0"}
            },
            {
              "type": "CALL",
              "value": "@tapUnit",
              "args": {"index":"1"}
            },
            {
              "type": "CALL",
              "value": "@tapUnit",
              "args": {"index":"2"}
            },
            {
              "type": "BATCH",
              "value": "END"
            },
            {
              "type": "REPEAT",
              "value": ""
            }
          ]
        },
        {
          "condition": {
            "var": "_loops",
            "is": "GREATER",
            "value": "20",
            "and": [
              {
                "is": "SCREEN",
                "value": "battle-unit-0_ready"
              }
            ]
          },
          "actions": [
            {
              "type": "INFO",
              "value": "Enabling Auto - Pause Detected"
            },
            {
              "type": "TAP",
              "value": "battle-auto"
            },
            {
              "type": "SET",
              "var": "_loops",
              "value": "0"
            },
            {
              "type": "SET",
              "value": "0",
              "var": "setup"
            },
            {
              "type": "REPEAT",
              "value": ""
            }
          ]
        }
      ]
    },

    "_common_battle-auto": {
      "name": "Common Battle - Auto",
      "statements": [
        {
          "condition": {
            "is": "SCREEN",
            "value": "game-battle",
            "and": [
              {
                "is": "SCREEN",
                "value": "game-battle-auto_off",
                "or": [
                  {
                    "is": "SCREEN",
                    "value": "game-battle-repeat"
                  }
                ]
              },
              {
                "is": "SCREEN",
                "value": "battle-unit-0_ready"
              }
            ]
          },
          "actions": [
            {
              "type": "INFO",
              "value": "Auto-Attack"
            },
            {
              "type": "TAP",
              "value": "battle-auto"
            },
            {
              "type": "SET",
              "value": "0",
              "var": "setup"
            },
            {
              "type": "REPEAT",
              "value": ""
            }
          ]
        },
        {
          "condition": {
            "is": "SCREEN",
            "value": "game-battle",
            "and": [
              {
                "not": "SCREEN",
                "value": "game-battle-auto_off"
              }
            ]
          },
          "actions": [
            {
              "type": "SET",
              "value": "0",
              "var": "_loops"
            }
          ]
        }
      ]
    },
    "_common_battle-repeat":{
      "name": "Common Battle - Repeat",
      "statements": [
        {
          "condition": {
            "is": "SCREEN",
            "value": "game-battle",
            "and": [
              {
                "is": "SCREEN",
                "value": "game-battle-auto_off",
                "or" : [
                  {
                    "is":"SCREEN",
                    "value": "game-battle-repeat"
                  }
                ]
              },
              {
                "is": "SCREEN",
                "value": "battle-unit-0_ready"
              }
            ]
          },
          "actions": [
            {
              "type": "INFO",
              "value": "Repeat-Attack"
            },
            {
              "type": "TAP",
              "value": "battle-repeat"
            },
            {
              "type": "TAP",
              "value": "battle-unit_5",
              "count": "1"
            },
            {
              "type": "SET",
              "value": "0",
              "var": "setup"
            },
            {
              "type": "WAIT",
              "value": "5000"
            },
            {
              "type": "REPEAT",
              "value": ""
            }
          ]
        },
        {
          "condition": {
            "is": "SCREEN",
            "value": "game-battle",
            "and": [
              {
                "not": "SCREEN",
                "value": "game-battle-auto_off"
              }
            ]
          },
          "actions": [
            {
              "type": "SET",
              "value": "0",
              "var": "_loops"
            }
          ]
        }
      ]
    },

    "@showUnitActions":{
      "name": "Function - Show Unit's Actions",
      "variables": {
        "index": {
          "value": "0",
          "type": "INT"
        }
      },
      "statements": [
        {
          "actions": [
            {
              "type": "SWIPE_RIGHT",
              "value": "battle-unit_${index}"
            },
            {
              "type": "WAIT",
              "value": "200"
            },
            {
              "type": "RETURN"
            }
          ]
        }
      ]
    },

    "@tapUnit":{
      "name": "Function - Tap Unit",
      "variables": {
        "index": {
          "value": "0",
          "type": "INT"
        }
      },
      "statements": [
        {
          "actions": [
            {
              "type": "TAP",
              "value": "battle-unit_${index}"
            },
            {
              "type": "RETURN"
            }
          ]
        }
      ]
    }

  }
}