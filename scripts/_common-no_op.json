//@formatter:off
{
  "vars": [{
      "name": "_seconds", "value": "0", "type": "INT", "modify": "VISIBLE", "display": "Run Time", "displayType": "SECONDS"}, {
      "name": "_loops", "value": "0", "type": "INT", "modify": "VISIBLE", "display": "Timer", "displayType": "SECONDS"}, {
      "name": "_screen_saver", "value": "0", "type": "INT", "modify": "VISIBLE", "display": "Screen Saver", "displayType": "SECONDS"}, {
      "name": "allow-ss", "display": "Enable Screen Saver", "value": "1", "type": "INT", "modify": "EDITABLE", "displayType": "BOOLEAN", "order": 10
    }
  ],

  "states": {

    "main": {
      "name": "! Main !",
      "includes": [
        "_common-no_op"
      ],
      "statements": [{
        "condition": {
          "var": "_loops", "is": "GREATER", "value": "15"
        },
        "actions": [{
          "type": "INFO", "value": "No main screens or popups detected, moving to log-in"}, {
          "type": "WAIT", "value": "2000"}, {
          "type": "MOVE", "value": "log-in"}
        ]
      }, {
        "condition": {
          "is": "SCREEN", "value": "menu_home"
        },
        "actions": [{
          "type": "WAIT", "value": "2000"}, {
          "type": "MOVE", "value": "home"}
        ]
      }]
    },

    "popup_handler": {
      "name": "Popup Handler",
      "includes": [
        "_popup_*"
      ],
      "statements": [{
        "condition": {
          "var": "_loops", "is": "GREATER", "value": "30"
        },
        "actions": [{
          "type": "INFO", "value": "Stuck on popup or unknown screen, moving to home"}, {
          "type": "WAIT", "value": "2000"}, {
          "type": "CALL", "value": "@keepAlive"}, {
          "type": "MOVE", "value": "home"}
        ]
      }]
    },

    "_popup_general": {
      "name": "Popup - General",
      "statements": [{
        "condition": {
          "is": "SCREEN", "value": "popup_general"
        },
        "actions": [{
          "type": "INFO", "value": "General Popup Detected"}, {
          "type": "TAP", "value": "popup_general-ok"}, {
          "type": "WAIT", "value": "2000"}, {
          "type": "CALL", "value": "@keepAlive"}, {
          "type": "REPEAT", "value": ""}
        ]
      }]
    },

    "_popup_package": {
      "name": "Popup - Package",
      "statements": [{
        "condition": {
          "is": "SCREEN", "value": "popup_package"
        },
        "actions": [{
          "type": "INFO", "value": "Package Popup Detected"}, {
          "type": "TAP", "value": "popup_package-close"}, {
          "type": "WAIT", "value": "2000"}, {
          "type": "CALL", "value": "@keepAlive"}, {
          "type": "REPEAT", "value": ""}
        ]
      }]
    },

    "_popup_package-scroll": {
      "name": "Popup - Package (Scrolls)",
      "statements": [{
        "condition": {
          "is": "SCREEN", "value": "popup_package-scroll"
        },
        "actions": [{
          "type": "INFO", "value": "Package Popup (Scroll) Detected"}, {
          "type": "EVENT", "value": "back"}, {
          "type": "WAIT", "value": "1000"}, {
          "type": "TAP", "value": "popup_package-scroll_close"}, {
          "type": "WAIT", "value": "2000"}, {
          "type": "CALL", "value": "@keepAlive"}, {
          "type": "REPEAT", "value": ""}
        ]
      }]
    },

    "_popup_gift-box": {
      "name": "Popup - Gift Box",
      "statements": [{
        "condition": {
          "is": "SCREEN", "value": "popup_gift-box"
        },
        "actions": [{
          "type": "INFO", "value": "Gift Box Popup Detected"}, {
          "type": "TAP", "value": "popup_gift-box_close"}, {
          "type": "WAIT", "value": "2000"}, {
          "type": "CALL", "value": "@keepAlive"}, {
          "type": "REPEAT", "value": ""}
        ]
      }]
    },

    "_popup_daily": {
      "name": "Popup - Daily",
      "statements": [{
        "condition": {
          "is": "SCREEN", "value": "popup_daily"
        },
        "actions": [{
          "type": "INFO", "value": "Daily Popup Detected"}, {
          "type": "TAP", "value": "popup_daily-close"}, {
          "type": "WAIT", "value": "2000"}, {
          "type": "CALL", "value": "@keepAlive"}, {
          "type": "REPEAT", "value": ""}
        ]
      }]
    },

    "_popup_disconnected": {
      "name": "Popup - Disconnected",
      "statements": [{
        "condition": {
          "is": "SCREEN", "value": "popup_disconnected"
        },
        "actions": [{
          "type": "INFO", "value": "Disconnected Popup Detected"}, {
          "type": "TAP", "value": "popup_disconnected-ok"}, {
          "type": "WAIT", "value": "2000"}, {
          "type": "CALL", "value": "@keepAlive"}, {
          "type": "REPEAT", "value": ""}
        ]
      }]
    },

    "_popup_arena-rewards": {
      "name": "Popup - Arena Rewards",
      "statements": [{
        "condition": {
          "is": "SCREEN", "value": "popup_arena-rewards"
        },
        "actions": [{
          "type": "INFO", "value": "Arena/Siege rewards Popup Detected"}, {
          "type": "TAP", "value": "popup_arena-rewards-ok"}, {
          "type": "WAIT", "value": "2000"}, {
          "type": "CALL", "value": "@keepAlive"}, {
          "type": "REPEAT", "value": ""}
        ]
      }]
    },

    "home": {
      "name": "Home",
      "includes": [
        "_backup_to_home",
        "_common-no_op"
      ],
      "statements": [{
        "condition": {
          "is": "SCREEN", "value": "menu_home"
        },
        "actions": [{
          "type": "INFO", "value": "Home Detected, moving to farm"}, {
          "type": "WAIT", "value": "1000"}, {
          "type": "CALL", "value": "@keepAlive"}, {
          "type": "MOVE", "value": "farm"}
        ]
      }]
    },

    "_backup_to_home": {
      "name": "Backup to Home",
      "statements": [{
        "condition": {
          "not": "SCREEN", "value": "menu_home"
        },
        "actions": [{
          "type": "INFO", "value": "Backing Up"}, {
          "type": "EVENT", "value": "back"}, {
          "type": "WAIT", "value": "2000"}, {
          "type": "REPEAT", "value": ""}
        ]
      }]
    },

    "farm": {
      "name": "Farm ! Selector !",
      "includes": [
        "farm_*"
      ],
      "statements": []
    },

    "log-in": {
      "name": "Login",
      "includes": [
        "_login_update",
        "_login_update-download",
        "_login_ads",
        "_login_notice"
      ],
      "statements": [{
        "condition": {
          "var": "_loops", "is": "GREATER", "value": "30"
        },
        "actions": [{
          "type": "INFO", "value": "Unknown screen detected during login, stopping."}, {
          "type": "STOP"}
        ]
      }, {
        "condition": {
          "is": "SCREEN", "value": "login_splash"
        },
        "actions": [{
          "type": "INFO", "value": "Log in successful"}, {
          "type": "TAP", "value": "login_splash-start"}, {
          "type": "WAIT", "value": "5000"}, {
          "type": "CALL", "value": "@keepAlive"}, {
          "type": "MOVE", "value": "main"}
        ]
      }]
    },

    "_login_update": {
      "name": "Login Ads",
      "statements": [{
        "condition": {
          "is": "SCREEN", "value": "login_update"
        },
        "actions": [{
          "type": "INFO", "value": "Log in update detected"}, {
          "type": "TAP", "value": "login_update-ok"}, {
          "type": "WAIT", "value": "2000"}, {
          "type": "REPEAT"}
        ]
      }]
    },

    "_login_update-download": {
      "name": "Login Ads",
      "statements": [{
        "condition": {
          "is": "SCREEN", "value": "login_update-download"
        },
        "actions": [{
          "type": "INFO", "value": "Log in download detected"}, {
          "type": "TAP", "value": "login_update-download-ok"}, {
          "type": "WAIT", "value": "5000"}, {
          "type": "REPEAT"}
        ]
      }]
    },

    "_login_ads": {
      "name": "Login Ads",
      "statements": [{
        "condition": {
          "is": "SCREEN", "value": "login_ads"
        },
        "actions": [{
          "type": "INFO", "value": "Log in ads detected"}, {
          "type": "TAP", "value": "login_ads-dont"}, {
          "type": "WAIT", "value": "2000"}, {
          "type": "REPEAT"}
        ]
      }]
    },

    "_login_notice": {
      "name": "Login Ads",
      "statements": [{
        "condition": {
          "is": "SCREEN", "value": "login_notice"
        },
        "actions": [{
          "type": "INFO", "value": "Login Notice Detected"}, {
          "type": "TAP", "value": "login_notice-ok"}, {
          "type": "WAIT", "value": "10000"}, {
          "type": "REPEAT"}
        ]
      }]
    },

    "_common-screen_saver": {
      "name": "Common - Screen Saver",
      "statements": [{
        "condition": {
          "var": "_screen_saver", "is": "GREATER", "value": "900",
          "and": [{
            "is": "EQUAL", "var": "allow-ss", "value": "1"}
          ]
        },
        "actions": [{
          "type": "SET", "value": "0", "var": "_screen_saver" }, {
          "type": "INFO", "value": "Screen saver activated"}, {
          "type": "EVENT", "value": "camera"}, {
          "type": "WAIT", "value": "5000"}, {
          "type": "EVENT", "value": "back"}, {
          "type": "WAIT", "value": "10000"}, {
          "type": "INFO", "value": "Returning"}, {
          "type": "REPEAT"}
        ]
      }]
    },

    "recovery": {
      "name": "Common - Recovery Template",
      "includes": [
        "_common-recovery_os"
      ]
    },

    "_common-recovery_os": {
      "name": "Common - Power Device Down",
      "includes": [
//        "_common-power_down"
      ]
    },

    "_common-power_down": {
      "name": "Common - Power Down",
      "statements": [{
        "condition": {
          "is": "BOOLEAN", "value": "true"
        },
        "actions": [{
          "type": "INFO", "value": "Default operation stops operations and locks the device"}, {
          "type": "EVENT", "value": "power"}, {
          "type": "STOP"}
        ]
      }]
    },

    "_common-no_op": {
      "name": "Common - No-Op",
      "includes": [
        "popup_handler"
      ],
      "statements": [{

        "condition": {
          "is": "SCREEN", "value": "os-home"
        },
        "actions": [{
          "type": "INFO", "value": "Home Screen Detected!"}, {
          "type": "TAP", "value": "os-app-icon"}, {
          "type": "MOVE", "value": "log-in"}
        ]
      }, {
        "condition": {
          "var": "_loops", "is": "GREATER", "value": "600"
        },
        "actions": [{
          "type": "INFO", "value": "Too many cycles, stopping run"}, {
          "type": "STOP"}
        ]
      }]
    },

    "@keepAlive": {
      "name": "Function - Keep Alive",
      "statements": [{
        "actions": [{
          "type": "SET", "var": "_loops", "value": "0"}, {
          "type": "RETURN"}
        ]
      }]
    },

    "@isB10": {
      "name": "Function - Is B10",
      "variables": {
        "index": {
          "value": "0", "type": "INT"
        }
      },
      "statements": [{
        "condition": {
          "is": "SCREEN", "value": "menu_caiross_level-b10-unlocked", "or": [{
            "is": "SCREEN", "value": "menu_caiross_level-b10-locked"
          }]
        },
        "actions": [{
          "type": "RETURN", "value": "1"}
          ]
      }, {
        "actions": [{
          "type": "RETURN", "value": "0"}
        ]
      }]
    },

    "@isBattle": {
      "name": "Function - Is Battle",
      "variables": {
        "index": {
          "value": "0", "type": "INT"
        }
      },
      "statements": [{
        "condition": {
          "is": "SCREEN", "value": "menu_caiross_level-b10-unlocked", "or": [{
            "is": "SCREEN", "value": "menu_caiross_level-b10-locked"
          }]
        },
        "actions": [{
          "type": "RETURN", "value": "1"}
          ]
      }, {
        "actions": [{
          "type": "RETURN", "value": "0"}
        ]
      }]
    }

  }
}